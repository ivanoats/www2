<%= render "head_and_sidebar" %>
<%= render 'navigation' %>

<h1>Checking out</h1>

<% if logged_in? %>
  You are signed in as <%= current_user.username %> (<%= current_user.email %>).  
  <% z_form_for :user do |f| %>    
    <% if current_user.accounts.empty? %>
    
      Name this account
        <%= text_field_tag :new_account_name, "Green Hosting" %>
    <% else %>
      <%= radio_button_tag :use_existing_account, true, true %>
      <label for='use_existing_account_true'>Pay with an existing account </label> <%= select :account, :id, current_user.accounts.collect { |a| [a.organization, a.id]}%>
      <br/>
      <%= radio_button_tag :use_existing_account, false %>
      <label for='use_existing_account_false'>Create a new account for this purchase </label><%= text_field_tag :new_account_name, "Green Hosting" %>
    <% end %>
    <%= submit_tag "Continue"%>
  <% end %>
<% else %>  
  Create a new user account to manage your hosting.  If you wish to add this purchase to an existing account, <%= link_to "sign in", login_url %>
  <% z_form_for :user do |f| %>
    <% f.fieldset :type => "inline" do %>
      <% z_fields_for :user do |u|%>
      
      <%= u.login %>
      <%= u.name %>
      <%= u.email %>
      <%= u.password %>
      <%= u.password_confirmation :label => "Confirm Password" %>
      <% end %>
      <% z_fields_for :account do |a| %>
        <%=  a.text_field :organization%>
      <% end %>
    <% end %>
  <% end %>
<% end %>

