<%= render "head_and_sidebar" %>
<%= render 'navigation' %>

<h1>Checking out</h1>

<% if logged_in? %>
  You are signed in as <%= current_user.username %> (<%= current_user.email %>).  
  <% z_form_for :account do |f| %>    
    <% if current_user.accounts.empty? %>
    
      Name this account
        <%= text_field_tag :new_account_name, "Green Hosting" %>
    <% else %>
      <%= radio_button_tag :use_existing_account, true, true %>
      <label for='use_existing_account_true'>Pay with an existing account </label>
        <%= f.select :id, current_user.accounts.collect { |a| [a.organization, a.id]}, :label => "Account Name"%>
      <br/>
      <%= radio_button_tag :use_existing_account, false %>
      <label for='use_existing_account_false'>Create a new account for this purchase </label>
      <% z_fields_for :account do |account| %>
        <%= account.text_field :organization, :label => "Account Name" %>
      <% end %>
    <% end %>
    <%= submit_tag "Continue"%>
  <% end %>
<% else %>  
  Create a new user account to manage your hosting.  If you wish to add this purchase to an existing account, <%= link_to "sign in", login_url %>
  <%= error_messages_for :user, :account %>
  <% z_form_for :user do |f| %>
    <% f.fieldset :legend => 'Create your Account', :type => "inline" do %>
      <%= f.text_field :email %>
      <%= f.text_field :login %>
      <%= f.password_field :password %>
      <%= f.password_field :password_confirmation, :label => "Confirm Password" %>
      <% z_fields_for :account do |a| %>
        <%=  a.text_field :organization%>
      <% end %>
      <%= f.submit "Create Account"%>
    <% end %>
  <% end %>
<% end %>

