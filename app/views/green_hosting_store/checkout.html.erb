
<h1>Checking out</h1>
<% if logged_in? %>
  <%= error_messages_for :account %>

  <p>You are signed in as <%= current_user.username %>.  </p>
  
  <% z_form_for :account do |f| %>    
    <% if current_user.accounts.empty? %>
        <%= f.text_field :organization, :label => "Name this Account" %>
    <% else %>
    
    <%= hidden_field_tag :use_existing_account, true %>
    <div id='use_existing'>
      Pay with an existing account or <%= link_to_function "create a new account", "jQuery('#use_existing, #create_new_account').toggle('slow'); $('#use_existing_account').val('false');"%>
        <%= f.select :id, current_user.accounts.collect { |a| [a.organization, a.id]}, :label => "Account Name"%>
      
    </div>
    <div id="create_new_account" style='display:none;'>
      Create a new account for this purchase or <%= link_to_function "add it to an existing account", "jQuery('#use_existing, #create_new_account').toggle('slow'); $('#use_existing_account').val('true');"%>
      <% z_fields_for :account do |account| %>
        <%= account.text_field :organization, :label => "Account Name" %>
      <% end %>
    </div> 
    <% end %>
    <br/>
    <%= submit_tag "Continue", :style => 'float: right'%>
  <% end %>
<% else %>  
  Create a new user account to manage your web hosting.  
  <br/>
  If you wish to add this purchase to an existing account, <%= link_to "sign in", login_url %>
  <%= error_messages_for [:user, :account] %>
  <% z_form_for :user do |f| %>
    <% f.fieldset :legend => 'Create your Account', :type => "inline" do %>
      <%= f.text_field :email %>
      <%= f.text_field :login %>
      <%= f.password_field :password %>
      <%= f.password_field :password_confirmation, :label => "Confirm Password" %>
      <% z_fields_for :account do |a| %>
        <%=  a.text_field :organization%>
      <% end %>
      <%= f.submit "Create Account", :style => 'float: right;'%>
    <% end %>
  <% end %>
<% end %>

